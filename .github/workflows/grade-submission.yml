# .github/workflows/grade-submission.yml
name: Grade JSON Submission

on:
  pull_request:
    types: [opened, synchronize]
    paths: ['pipeline-exercise.json']

jobs:
  grade:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Grade submission
      run: |
        python grading/simple_grader.py --file pipeline-exercise.json --output results.json
    
    - name: Comment results
      uses: actions/github-script@v7
      with:
        script: |
          const fs = require('fs');
          const results = JSON.parse(fs.readFileSync('results.json', 'utf8'));
          
          const comment = `## ðŸŽ¯ RÃ©sultats automatiques
          
          **Score: ${results.total_score}/20**
          
          ### DÃ©tail:
          ${results.sections.map(s => 
            `- ${s.name}: ${s.score}/${s.max_score} points`
          ).join('\n')}
          
          ${results.feedback}`;
          
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: comment
          });